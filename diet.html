<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="bmi.css" />
    <script src="bmi.js" defer></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div class="nav-logo">
      <div class="hamburger" onclick="toggleMenu()">â˜°</div>
      <div class="nav-logo-text" id="pagetitle">BMI Calculator</div>
    </div>
    <div class="layout-container">
      <nav id="navLinks">
        <div class="nav-links">
          <a href="index.html">Calculator</a>
          <a href="about.html">About</a>
          <a href="diet.html">Diet Plan</a>
          <a href="contact.html">Contact</a>
        </div>
      </nav>
      <section>
        <div class="main-section">
          <div class="main-heading">What are we having today ?</div>
          <div class="calorie-container" id="caloriecontainer"></div>
          <p style="text-align: center; font-size: 50px">Explore More</p>
          <div class="filters-wrapper">
            <span class="filters">
              <label for="healthFilter"> Filter</label>
              <select id="healthFilter">
                <option value="all">All</option>
                <option value="vegan">Vegan</option>
                <option value="vegetarian">Vegetarian</option>
                <option value="paleo">Paleo</option>
                <option value="dairy-free">Dairy Free</option>
                <option value="gluten-free">Gluten Free</option>
                <option value="egg-free">Egg Free</option>
                <option value="peanut-free">Peanut Free</option>
                <option value="tree-nut-free">Tree Nut Free</option>
                <option value="soy-free">Soy Free</option>
                <option value="fish-free">Fish Free</option>
                <option value="shellfish-free">Shellfish Free</option>
              </select>
            </span>
            <span class="filters" style="margin-left: 20px">
              <label for="cusinefilter">Cusine</label>
              <select id="cusinefilter">
                <option value="all">All</option>
                <option value="italian">Italian</option>
                <option value="american">American</option>
                <option value="nordic">Nordic</option>
                <option value="mexican">Mexican</option>
                <option value="eastern europe">Eastern europe</option>
                <option value="indian">Indian</option>
                <option value=": south american">South american</option>
                <option value=": mediterranean">Mediterranean</option>
                <option value=": french">French</option>
              </select>
            </span>
          </div>

          <div id="dietcontainer" class="dietcontainer"></div>

          <script>
            document.addEventListener("DOMContentLoaded", () => {
              const Mealplan = JSON.parse(sessionStorage.getItem("Mealplan"));
              const Calorieplan = JSON.parse(
                sessionStorage.getItem("Calorieplan")
              );
              console.log(Calorieplan);

              console.log(Mealplan);
              const calorieContainer =
                document.getElementById("caloriecontainer");
              const container = document.getElementById("dietcontainer");
              const healthFilter = document.getElementById("healthFilter");
              const cusinefilter = document.getElementById("cusinefilter");

              if (!Calorieplan || !Calorieplan.meals) {
                calorieContainer.innerHTML = `<h3>Cant fetch the calorie based plan calculate BMI first <a href="index.html">Calculate!</a>`;
                return;
              }
              function calorieRender(bmirecipe) {
                calorieContainer.innerHTML = "";
                bmirecipe.meals.forEach((recipe) => {
                  const caloriecard = document.createElement("div");
                  caloriecard.classList.add("mealcard");
                  caloriecard.innerHTML = `
                  <h3>${recipe.title}</h3>
                  <img src="https://spoonacular.com/recipeImages/${
                    recipe.image
                  }" alt=${recipe.title}>
                  <p>Calories : ${Math.round(bmirecipe.nutrients.calories / 3)}
                  <p> fat : ${Math.round(bmirecipe.nutrients.fat / 3)}
                  <p> Protein : ${Math.round(
                    bmirecipe.nutrients.protein
                  )}<br><br>
                  <a href="${recipe.sourceUrl}" target="_blank">View Recipe</a>
                  `;
                  calorieContainer.appendChild(caloriecard);
                });
              }

              calorieRender(Calorieplan); // calorie card from spoonacular api

              if (!Mealplan || !Mealplan.hits) {
                container.innerHTML = `
                  No meal data found. Calculate BMI first! <a href="index.html">Calculate!</a>
                `;
                return;
              }
              // Function to render recipes
              function renderRecipes(recipes) {
                container.innerHTML = ""; // clear container
                recipes.forEach((item) => {
                  const card = document.createElement("div");
                  card.classList.add("mealcard");
                  card.innerHTML = `
                  <h3>${item.recipe.label}</h3>
                  <img src="${item.recipe.image}" alt="${item.recipe.label}" />
                  <p>Calories: ${Math.round(item.recipe.calories)} kcal</p>
                  <p> Cusine : ${item.recipe.cuisineType}</p>
                  <p>Fat : ${Math.round(
                    item.recipe.totalNutrients.FAT.quantity
                  )} g </p>
                  <p> cautions : ${item.recipe.cautions}</p>
                  <a href="${
                    item.recipe.url
                  }" target="_blank">View Recipe</a> `;
                  container.appendChild(card);
                });
              }

              // Initial render
              renderRecipes(Mealplan.hits);

              function applyFilters() {
                const selected_health = healthFilter.value.toLowerCase();
                const selected_cusine = cusinefilter.value.toLowerCase();

                const filtered = Mealplan.hits.filter((item) => {
                  let health_filtered;
                  if (selected_health === "all") {
                    health_filtered = true;
                  } else {
                    health_filtered = item.recipe.healthLabels.some(
                      (label) => label.toLowerCase() === selected_health
                    );
                  }

                  let cusine_filtered;
                  if (selected_cusine === "all") {
                    cusine_filtered = true;
                  } else {
                    cusine_filtered = item.recipe.cuisineType.some(
                      (c) => c.toLowerCase() === selected_cusine
                    );
                  }

                  return health_filtered && cusine_filtered;
                });

                renderRecipes(filtered);
              }

              healthFilter.addEventListener("change", applyFilters);
              cusinefilter.addEventListener("change", applyFilters);
            });
          </script>
        </div>
      </section>
    </div>
  </body>
</html>
